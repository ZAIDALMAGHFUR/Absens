import _,{Fragment as le,createContext as z,useContext as V,useMemo as v,useReducer as oe,useRef as w}from"react";import{render as O,Features as re,forwardRefWithAs as U}from'../../utils/render.js';import{useId as ne}from'../../hooks/use-id.js';import{match as H}from'../../utils/match.js';import{Keys as y}from'../../components/keyboard.js';import{focusIn as F,Focus as R,sortByDomNode as k,FocusResult as j}from'../../utils/focus-management.js';import{useIsoMorphicEffect as B}from'../../hooks/use-iso-morphic-effect.js';import{useSyncRefs as G}from'../../hooks/use-sync-refs.js';import{useResolveButtonType as se}from'../../hooks/use-resolve-button-type.js';import{useLatestValue as J}from'../../hooks/use-latest-value.js';import{FocusSentinel as ie}from'../../internal/focus-sentinel.js';import{useEvent as h}from'../../hooks/use-event.js';import{microTask as ue}from'../../utils/micro-task.js';import{Hidden as ce}from'../../internal/hidden.js';import{getOwnerDocument as de}from'../../utils/owner.js';var pe=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(pe||{}),fe=(l=>(l[l.Less=-1]="Less",l[l.Equal=0]="Equal",l[l.Greater=1]="Greater",l))(fe||{}),be=(a=>(a[a.SetSelectedIndex=0]="SetSelectedIndex",a[a.RegisterTab=1]="RegisterTab",a[a.UnregisterTab=2]="UnregisterTab",a[a.RegisterPanel=3]="RegisterPanel",a[a.UnregisterPanel=4]="UnregisterPanel",a))(be||{});let Te={[0](r,e){var P;let t=k(r.tabs,o=>o.current),l=k(r.panels,o=>o.current),s=t.filter(o=>{var b;return!((b=o.current)!=null&&b.hasAttribute("disabled"))}),a={...r,tabs:t,panels:l};if(e.index<0||e.index>t.length-1){let o=H(Math.sign(e.index-r.selectedIndex),{[-1]:()=>1,[0]:()=>H(Math.sign(e.index),{[-1]:()=>0,[0]:()=>0,[1]:()=>1}),[1]:()=>0});return{...a,selectedIndex:H(o,{[0]:()=>t.indexOf(s[0]),[1]:()=>t.indexOf(s[s.length-1])})}}let p=t.slice(0,e.index),A=[...t.slice(e.index),...p].find(o=>s.includes(o));if(!A)return a;let f=(P=t.indexOf(A))!=null?P:r.selectedIndex;return f===-1&&(f=r.selectedIndex),{...a,selectedIndex:f}},[1](r,e){var a;if(r.tabs.includes(e.tab))return r;let t=r.tabs[r.selectedIndex],l=k([...r.tabs,e.tab],p=>p.current),s=(a=l.indexOf(t))!=null?a:r.selectedIndex;return s===-1&&(s=r.selectedIndex),{...r,tabs:l,selectedIndex:s}},[2](r,e){return{...r,tabs:r.tabs.filter(t=>t!==e.tab)}},[3](r,e){return r.panels.includes(e.panel)?r:{...r,panels:k([...r.panels,e.panel],t=>t.current)}},[4](r,e){return{...r,panels:r.panels.filter(t=>t!==e.panel)}}},Q=z(null);Q.displayName="TabsSSRContext";function X(r){let e=V(Q);if(e===null){let t=new Error(`<${r} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,X),t}return e}let Y=z(null);Y.displayName="TabsDataContext";function C(r){let e=V(Y);if(e===null){let t=new Error(`<${r} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,C),t}return e}let Z=z(null);Z.displayName="TabsActionsContext";function ee(r){let e=V(Z);if(e===null){let t=new Error(`<${r} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,ee),t}return e}function me(r,e){return H(e.type,Te,r,e)}let Pe=le,xe=U(function(e,t){let{defaultIndex:l=0,vertical:s=!1,manual:a=!1,onChange:p,selectedIndex:c=null,...A}=e;const f=s?"vertical":"horizontal",P=a?"manual":"auto";let o=c!==null,b=G(t),[d,i]=oe(me,{selectedIndex:c!=null?c:l,tabs:[],panels:[]}),S=v(()=>({selectedIndex:d.selectedIndex}),[d.selectedIndex]),T=J(p||(()=>{})),x=J(d.tabs),g=v(()=>({orientation:f,activation:P,...d}),[f,P,d]),L=h(u=>(i({type:1,tab:u}),()=>i({type:2,tab:u}))),D=h(u=>(i({type:3,panel:u}),()=>i({type:4,panel:u}))),E=h(u=>{I.current!==u&&T.current(u),o||i({type:0,index:u})}),I=J(o?e.selectedIndex:d.selectedIndex),W=v(()=>({registerTab:L,registerPanel:D,change:E}),[]);B(()=>{i({type:0,index:c!=null?c:l})},[c]),B(()=>{if(I.current===void 0||d.tabs.length<=0)return;let u=k(d.tabs,n=>n.current);u.some((n,m)=>d.tabs[m]!==n)&&E(u.indexOf(d.tabs[I.current]))});let N=w({tabs:0,panels:0}),K={ref:b};return _.createElement(Q.Provider,{value:N},_.createElement(Z.Provider,{value:W},_.createElement(Y.Provider,{value:g},g.tabs.length<=0&&_.createElement(ie,{onFocus:()=>{var u,M;for(let n of x.current)if(((u=n.current)==null?void 0:u.tabIndex)===0)return(M=n.current)==null||M.focus(),!0;return!1}}),O({ourProps:K,theirProps:A,slot:S,defaultTag:Pe,name:"Tabs"}))))}),ge="div",ye=U(function(e,t){let{orientation:l,selectedIndex:s}=C("Tab.List"),a=G(t);return O({ourProps:{ref:a,role:"tablist","aria-orientation":l},theirProps:e,slot:{selectedIndex:s},defaultTag:ge,name:"Tabs.List"})}),Re="button",Ae=U(function(e,t){var u,M;let l=ne(),{id:s=`headlessui-tabs-tab-${l}`,...a}=e,{orientation:p,activation:c,selectedIndex:A,tabs:f,panels:P}=C("Tab"),o=ee("Tab"),b=C("Tab"),d=X("Tab"),i=w(null),S=G(i,t);B(()=>o.registerTab(i),[o,i]);let T=w(-1);T.current===-1&&(T.current=d.current?d.current.tabs++:-1);let x=f.indexOf(i);x===-1&&(x=T.current);let g=x===A,L=h(n=>{var $;let m=n();if(m===j.Success&&c==="auto"){let q=($=de(i))==null?void 0:$.activeElement,te=b.tabs.findIndex(ae=>ae.current===q);te!==-1&&o.change(te)}return m}),D=h(n=>{let m=f.map(q=>q.current).filter(Boolean);if(n.key===y.Space||n.key===y.Enter){n.preventDefault(),n.stopPropagation(),o.change(x);return}switch(n.key){case y.Home:case y.PageUp:return n.preventDefault(),n.stopPropagation(),L(()=>F(m,R.First));case y.End:case y.PageDown:return n.preventDefault(),n.stopPropagation(),L(()=>F(m,R.Last))}if(L(()=>H(p,{vertical(){return n.key===y.ArrowUp?F(m,R.Previous|R.WrapAround):n.key===y.ArrowDown?F(m,R.Next|R.WrapAround):j.Error},horizontal(){return n.key===y.ArrowLeft?F(m,R.Previous|R.WrapAround):n.key===y.ArrowRight?F(m,R.Next|R.WrapAround):j.Error}}))===j.Success)return n.preventDefault()}),E=w(!1),I=h(()=>{var n;E.current||(E.current=!0,(n=i.current)==null||n.focus(),o.change(x),ue(()=>{E.current=!1}))}),W=h(n=>{n.preventDefault()}),N=v(()=>({selected:g}),[g]),K={ref:S,onKeyDown:D,onMouseDown:W,onClick:I,id:s,role:"tab",type:se(e,i),"aria-controls":(M=(u=P[x])==null?void 0:u.current)==null?void 0:M.id,"aria-selected":g,tabIndex:g?0:-1};return O({ourProps:K,theirProps:a,slot:N,defaultTag:Re,name:"Tabs.Tab"})}),Ee="div",Se=U(function(e,t){let{selectedIndex:l}=C("Tab.Panels"),s=G(t),a=v(()=>({selectedIndex:l}),[l]);return O({ourProps:{ref:s},theirProps:e,slot:a,defaultTag:Ee,name:"Tabs.Panels"})}),Le="div",Ie=re.RenderStrategy|re.Static,he=U(function(e,t){var L,D,E,I;let l=ne(),{id:s=`headlessui-tabs-panel-${l}`,tabIndex:a=0,...p}=e,{selectedIndex:c,tabs:A,panels:f}=C("Tab.Panel"),P=ee("Tab.Panel"),o=X("Tab.Panel"),b=w(null),d=G(b,t);B(()=>P.registerPanel(b),[P,b]);let i=w(-1);i.current===-1&&(i.current=o.current?o.current.panels++:-1);let S=f.indexOf(b);S===-1&&(S=i.current);let T=S===c,x=v(()=>({selected:T}),[T]),g={ref:d,id:s,role:"tabpanel","aria-labelledby":(D=(L=A[S])==null?void 0:L.current)==null?void 0:D.id,tabIndex:T?a:-1};return!T&&((E=p.unmount)!=null?E:!0)&&!((I=p.static)!=null&&I)?_.createElement(ce,{as:"span",...g}):O({ourProps:g,theirProps:p,slot:x,defaultTag:Le,features:Ie,visible:T,name:"Tabs.Panel"})}),Xe=Object.assign(Ae,{Group:xe,List:ye,Panels:Se,Panel:he});export{Xe as Tab};
